<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Piko | Documentation</title>
    <meta
      name="description"
      content="Documentation for Piko - isolated development environments using Git worktrees, tmux, and Docker."
    />
    <style>
      :root {
        --bg-color: #0a0a0a;
        --text-main: #ededed;
        --text-muted: #888888;
        --accent: #00ff9d;
        --border: rgba(255, 255, 255, 0.1);
        --sidebar-width: 200px;
        --font-sans: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, sans-serif;
        --font-mono: "JetBrains Mono", "Fira Code", monospace;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html {
        scroll-behavior: smooth;
        scroll-padding-top: 80px;
      }

      body {
        background-color: var(--bg-color);
        color: var(--text-main);
        font-family: var(--font-sans);
        line-height: 1.7;
        min-height: 100vh;
      }

      .grid-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: linear-gradient(
            rgba(255, 255, 255, 0.03) 1px,
            transparent 1px
          ),
          linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
        background-size: 40px 40px;
        z-index: -1;
      }

      nav {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: rgba(10, 10, 10, 0.95);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid var(--border);
        padding: 1rem 2rem;
        z-index: 100;
      }

      nav .inner {
        max-width: 900px;
        margin: 0 auto;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      nav a {
        color: var(--text-main);
        text-decoration: none;
        font-family: var(--font-mono);
        font-size: 0.9rem;
      }

      nav a:hover {
        color: var(--accent);
      }

      nav .logo {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 700;
        font-size: 1.1rem;
      }

      nav .logo-mark {
        width: 8px;
        height: 8px;
        background-color: var(--accent);
        border-radius: 50%;
      }

      .menu-toggle {
        display: none;
        background: none;
        border: 1px solid var(--border);
        color: var(--text-main);
        padding: 0.5rem 0.75rem;
        border-radius: 4px;
        font-family: var(--font-mono);
        font-size: 0.8rem;
        cursor: pointer;
      }

      .layout {
        display: flex;
        max-width: 900px;
        margin: 0 auto;
        padding-top: 60px;
      }

      .sidebar {
        width: var(--sidebar-width);
        flex-shrink: 0;
        padding: 2rem 1rem 2rem 0;
        position: sticky;
        top: 60px;
        height: calc(100vh - 60px);
        overflow-y: auto;
      }

      .sidebar-group {
        margin-bottom: 1.5rem;
      }

      .sidebar-title {
        font-size: 0.65rem;
        font-weight: 600;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.1em;
        margin-bottom: 0.5rem;
        font-family: var(--font-mono);
      }

      .sidebar ul {
        list-style: none;
      }

      .sidebar li {
        margin-bottom: 0.25rem;
      }

      .sidebar a {
        color: var(--text-muted);
        text-decoration: none;
        font-size: 0.85rem;
        display: block;
        padding: 0.2rem 0;
        transition: color 0.15s;
      }

      .sidebar a:hover,
      .sidebar a.active {
        color: var(--accent);
      }

      .content {
        flex: 1;
        min-width: 0;
        padding: 2rem 0 4rem 2rem;
        border-left: 1px solid var(--border);
      }

      h1 {
        font-size: 1.75rem;
        font-weight: 700;
        letter-spacing: -0.03em;
        margin-bottom: 1.5rem;
      }

      h2 {
        font-size: 1.1rem;
        font-weight: 600;
        margin: 2.5rem 0 0.75rem;
        padding-top: 1rem;
        border-top: 1px solid var(--border);
      }

      h2:first-of-type {
        margin-top: 0;
        padding-top: 0;
        border-top: none;
      }

      h3 {
        font-size: 0.95rem;
        font-weight: 600;
        margin: 1.5rem 0 0.5rem;
        color: var(--text-main);
      }

      p {
        color: var(--text-muted);
        margin-bottom: 1rem;
        font-size: 0.9rem;
      }

      p strong {
        color: var(--text-main);
        font-weight: 500;
      }

      code {
        font-family: var(--font-mono);
        font-size: 0.8em;
        background: rgba(255, 255, 255, 0.05);
        padding: 0.15em 0.4em;
        border-radius: 3px;
      }

      pre {
        font-family: var(--font-mono);
        font-size: 0.8rem;
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid var(--border);
        border-radius: 4px;
        padding: 1rem 1.25rem;
        overflow-x: auto;
        margin: 0.75rem 0 1.25rem;
      }

      pre code {
        background: none;
        padding: 0;
      }

      .cmd {
        color: var(--accent);
      }

      .arg {
        color: #60a5fa;
      }

      .comment {
        color: var(--text-muted);
      }

      .cmd-table {
        width: 100%;
        margin: 0.75rem 0 1.25rem;
        border-collapse: collapse;
        font-size: 0.85rem;
      }

      .cmd-table td {
        padding: 0.5rem 0;
        border-bottom: 1px solid var(--border);
        vertical-align: top;
      }

      .cmd-table td:first-child {
        font-family: var(--font-mono);
        color: var(--text-main);
        white-space: nowrap;
        padding-right: 1.5rem;
        width: 40%;
      }

      .cmd-table td:last-child {
        color: var(--text-muted);
      }

      .cmd-table tr:last-child td {
        border-bottom: none;
      }

      footer {
        padding: 2rem;
        text-align: center;
        color: rgba(255, 255, 255, 0.2);
        font-size: 0.8rem;
        font-family: var(--font-mono);
        border-top: 1px solid var(--border);
        margin-left: var(--sidebar-width);
      }

      @media (max-width: 768px) {
        .menu-toggle {
          display: block;
        }

        .sidebar {
          position: fixed;
          top: 60px;
          left: 0;
          width: 100%;
          height: auto;
          max-height: calc(100vh - 60px);
          background: rgba(10, 10, 10, 0.98);
          border-bottom: 1px solid var(--border);
          padding: 1.5rem 2rem;
          transform: translateY(-100%);
          opacity: 0;
          visibility: hidden;
          transition: transform 0.3s, opacity 0.3s, visibility 0.3s;
          z-index: 50;
        }

        .sidebar.open {
          transform: translateY(0);
          opacity: 1;
          visibility: visible;
        }

        .content {
          border-left: none;
          padding: 2rem 1.5rem 4rem;
        }

        footer {
          margin-left: 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="grid-bg"></div>

    <nav>
      <div class="inner">
        <a href="index.html" class="logo">
          <span class="logo-mark"></span>
          piko
        </a>
        <div style="display: flex; gap: 1.5rem; align-items: center">
          <a href="https://github.com/bearsignals/piko">GitHub</a>
          <button class="menu-toggle" onclick="toggleSidebar()">Menu</button>
        </div>
      </div>
    </nav>

    <div class="layout">
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-group">
          <div class="sidebar-title">Basics</div>
          <ul>
            <li><a href="#install">Install</a></li>
            <li><a href="#quick-start">Quick Start</a></li>
          </ul>
        </div>
        <div class="sidebar-group">
          <div class="sidebar-title">Reference</div>
          <ul>
            <li><a href="#commands">Commands</a></li>
            <li><a href="#env-vars">Environment Variables</a></li>
            <li><a href="#configuration">Configuration</a></li>
          </ul>
        </div>
        <div class="sidebar-group">
          <div class="sidebar-title">Advanced</div>
          <ul>
            <li><a href="#modes">Docker vs Simple Mode</a></li>
            <li><a href="#claude-code">Claude Code Integration</a></li>
          </ul>
        </div>
      </aside>

      <main class="content">
        <h1>Documentation</h1>

        <h2 id="install">Install</h2>
        <pre><code>go install github.com/bearsignals/piko@latest</code></pre>
        <p>Requires Go 1.21+, Git, and tmux. Docker is optional.</p>

        <h2 id="quick-start">Quick Start</h2>
        <pre><code><span class="comment"># Initialize piko in your project</span>
cd ~/projects/myapp
piko init

<span class="comment"># Create an isolated environment</span>
piko create <span class="arg">feature-auth</span>

<span class="comment"># You're now in a tmux session with:</span>
<span class="comment"># - A git worktree at .piko/worktrees/feature-auth</span>
<span class="comment"># - Containers running (if docker-compose.yml exists)</span>
<span class="comment"># - Environment variables set (PIKO_*)</span>

<span class="comment"># Later, reattach to the session</span>
piko attach <span class="arg">feature-auth</span>

<span class="comment"># When done, tear it all down</span>
piko destroy <span class="arg">feature-auth</span></code></pre>

        <h2 id="commands">Commands</h2>

        <h3>Core</h3>
        <table class="cmd-table">
          <tr>
            <td>piko init</td>
            <td>Initialize piko in the current project</td>
          </tr>
          <tr>
            <td>piko create &lt;name&gt;</td>
            <td>Create a new environment (worktree + containers + tmux)</td>
          </tr>
          <tr>
            <td>piko attach &lt;name&gt;</td>
            <td>Attach to an existing environment's tmux session</td>
          </tr>
          <tr>
            <td>piko destroy &lt;name&gt;</td>
            <td>Tear down environment (removes worktree, stops containers)</td>
          </tr>
        </table>

        <h3>Server &amp; Diagnostics</h3>
        <table class="cmd-table">
          <tr>
            <td>piko server</td>
            <td>Start the web UI and API server</td>
          </tr>
          <tr>
            <td>piko doctor</td>
            <td>Check system dependencies and hook status</td>
          </tr>
          <tr>
            <td>piko project ls</td>
            <td>List all registered projects</td>
          </tr>
        </table>

        <h2 id="env-vars">Environment Variables</h2>
        <p>Available in your tmux session and scripts:</p>
        <table class="cmd-table">
          <tr>
            <td>PIKO_ENV_NAME</td>
            <td>Environment name (e.g., "feature-auth")</td>
          </tr>
          <tr>
            <td>PIKO_ENV_ID</td>
            <td>Unique integer, useful for port derivation</td>
          </tr>
          <tr>
            <td>PIKO_ENV_PATH</td>
            <td>Path to the worktree</td>
          </tr>
          <tr>
            <td>PIKO_DATA_DIR</td>
            <td>Path to data directory for databases, caches</td>
          </tr>
          <tr>
            <td>PIKO_ROOT</td>
            <td>Project root path</td>
          </tr>
          <tr>
            <td>PIKO_DB_PORT</td>
            <td>Allocated database port (Docker mode)</td>
          </tr>
        </table>

        <h3>Port Derivation</h3>
        <p>Use <code>PIKO_ENV_ID</code> to avoid port conflicts:</p>
        <pre><code><span class="comment"># Shell</span>
npm run dev -- --port $((3000 + PIKO_ENV_ID))

<span class="comment"># vite.config.js</span>
server: { port: 3000 + parseInt(process.env.PIKO_ENV_ID || 0) }</code></pre>

        <h3>Database Isolation</h3>
        <pre><code><span class="comment"># SQLite</span>
DATABASE_URL=sqlite:${PIKO_DATA_DIR}/dev.db

<span class="comment"># Postgres (Docker mode)</span>
DATABASE_URL=postgres://localhost:${PIKO_DB_PORT}/dev</code></pre>

        <h2 id="configuration">Configuration</h2>
        <p>Piko works without configuration. Optionally create <code>.piko.yml</code> to hook into the environment lifecycle:</p>
        <pre><code>scripts:
  setup: |
    npm install
    ln -s "$PIKO_ROOT/.env.local" .env.local

  run: |
    npm run dev -- --port $((3000 + PIKO_ENV_ID))</code></pre>

        <h3>Lifecycle Hooks</h3>
        <table class="cmd-table">
          <tr>
            <td>setup</td>
            <td>Runs once after <code>piko create</code>. Use for installing dependencies, symlinking config files, or any one-time setup.</td>
          </tr>
          <tr>
            <td>run</td>
            <td>Executed by <code>piko env run &lt;name&gt;</code>. Use for starting your dev server with environment-specific config.</td>
          </tr>
        </table>
        <p>All scripts run inside the worktree directory with <code>PIKO_*</code> environment variables available.</p>

        <h2 id="modes">Docker vs Simple Mode</h2>

        <h3>Docker Mode</h3>
        <p>If your project has <code>docker-compose.yml</code>, piko automatically:</p>
        <ul style="color: var(--text-muted); font-size: 0.9rem; margin: 0.5rem 0 1rem 1.5rem;">
          <li>Creates an isolated Docker network per environment</li>
          <li>Allocates unique ports dynamically</li>
          <li>Sets <code>PIKO_DB_PORT</code> for database access</li>
        </ul>

        <h3>Simple Mode</h3>
        <p>Without Docker Compose, piko provides:</p>
        <ul style="color: var(--text-muted); font-size: 0.9rem; margin: 0.5rem 0 1rem 1.5rem;">
          <li>Git worktrees for code isolation</li>
          <li>Tmux sessions for terminal management</li>
          <li>Data directories for state isolation</li>
          <li>Environment variables for port derivation</li>
        </ul>
        <p>Mode is auto-detected. No configuration needed.</p>

        <h2 id="claude-code">Claude Code Integration</h2>
        <p>Piko integrates with Claude Code to show permission prompts in a web UI instead of the terminal.</p>

        <h3>How It Works</h3>
        <p>When Claude Code requests permission (file edit, bash command, etc.), piko:</p>
        <ul style="color: var(--text-muted); font-size: 0.9rem; margin: 0.5rem 0 1rem 1.5rem;">
          <li>Receives the notification via hooks</li>
          <li>Displays it in the web UI at <code>http://localhost:19876</code></li>
          <li>Sends your response back to Claude Code</li>
        </ul>

        <h3>Setup</h3>
        <pre><code><span class="comment"># Initialize Claude Code hooks (run this before starting Claude)</span>
piko cc init

<span class="comment"># Start the piko server</span>
piko server</code></pre>
        <p>The <code>piko cc init</code> command creates <code>.claude/settings.json</code> with hooks that route notifications to piko. Run this before launching Claude Code in your environment.</p>

        <h3>Diagnostics</h3>
        <pre><code><span class="comment"># Check hook status for all environments</span>
piko doctor</code></pre>
        <p>This shows whether hooks are installed and if the server is running.</p>

      </main>
    </div>

    <footer>
      &copy;
      <script>
        document.write(new Date().getFullYear());
      </script>
      Bearsignals
    </footer>

    <script>
      function toggleSidebar() {
        document.getElementById("sidebar").classList.toggle("open");
      }

      document.querySelectorAll(".sidebar a").forEach((link) => {
        link.addEventListener("click", () => {
          document.getElementById("sidebar").classList.remove("open");
        });
      });
    </script>
  </body>
</html>
